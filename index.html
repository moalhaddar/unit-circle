<html>
    <script>
        window.onload = () => {
            /** @type {HTMLCanvasElement} */
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            let mouseX = 0;
            let mouseY = 0;
            let angleInRad = 0;
            let slope = 0;
            let isAuto = false;

            canvas.addEventListener('mousemove', (event) => {
                mouseX = event.clientX;
                mouseY = event.clientY;
            });

            document.addEventListener('keypress', (e) => {
                if (e.key.toLowerCase() === 'm') {
                    isAuto = !isAuto
                }
            })
            
            function render() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = 200;

                const dx = mouseX - centerX;
                const dy = -1 * (mouseY - centerY);

                if (isAuto) {
                    angleInRad = (angleInRad + 0.01) % 180;
                    if (angleInRad >= Math.PI * 2) {
                        angleInRad = 0;
                    }
                } else {
                    angleInRad = Math.atan2(dy, dx);
                }

                ctx.fillStyle = "black";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.save();

                ctx.strokeStyle = 'white';
                ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.stroke();

                // Draw x and y axes
                ctx.lineWidth = 2;
                
                ctx.strokeStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(canvas.width, centerY);
                ctx.stroke();

                ctx.strokeStyle = 'white';
                ctx.beginPath();
                    ctx.moveTo(centerX, 0);
                    ctx.lineTo(centerX, canvas.height);
                ctx.stroke();

                ctx.strokeStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                
                const endX = centerX + radius * Math.cos(angleInRad);
                const endY = centerY + radius * Math.sin(-angleInRad);
                
                ctx.lineTo(endX, endY);
                ctx.stroke();

                // cos
                ctx.strokeStyle = 'red'
                ctx.beginPath();
                    ctx.moveTo(centerX, endY);
                    ctx.lineTo(endX, endY);
                ctx.stroke();

                // sin
                ctx.strokeStyle = 'green'
                ctx.beginPath();
                    ctx.moveTo(endX, centerY);
                    ctx.lineTo(endX, endY);
                ctx.stroke();

                // tan & cotan
                ctx.strokeStyle = 'pink'
                ctx.beginPath();
                    {
                        const nextAngleInRad = angleInRad + 0.1;
                        const nextEndX = centerX + radius * Math.cos(nextAngleInRad);
                        const nextEndY = centerY + radius * Math.sin(-nextAngleInRad);
                        slope = (nextEndY - endY) / (nextEndX - endX);
                        
                    }
                ctx.stroke();

                ctx.strokeStyle = 'red';
                ctx.beginPath();
                    ctx.arc(centerX, centerY, radius / 10, 0, (2 * Math.PI) - angleInRad, true);
                ctx.stroke();

                // Display angle value
                let angleInDegrees = (angleInRad * 180 / Math.PI)
                if (angleInDegrees < 0) {
                    angleInDegrees = 360 - (angleInDegrees * -1);
                }
                ctx.fillStyle = 'white';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${angleInDegrees.toFixed(2)} deg`, centerX, centerY - 10);

                // Display sin and cos values
                const sinValue = Math.sin(angleInRad);
                const cosValue = Math.cos(angleInRad);
                ctx.fillStyle = 'green';
                ctx.fillText(`sin: ${sinValue.toFixed(2)}`, endX + 10, (centerY + endY) / 2);
                ctx.fillStyle = 'red';
                ctx.fillText(`cos: ${cosValue.toFixed(2)}`, (centerX + endX) / 2, endY + 20);

                // // Display dx and dy values
                ctx.font = 'bold 16px Arial';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'left';
                ctx.fillText(`dx: ${dx.toFixed(2)}`, 10, 20);
                ctx.fillText(`dy: ${dy.toFixed(2)}`, 10, 40);
                ctx.fillText(`endX: ${endX.toFixed(2)}`, 10, 60);
                ctx.fillText(`endY: ${endY.toFixed(2)}`, 10, 80);
                ctx.fillText(`angle: ${angleInRad.toFixed(2)}`, 10, 100);
                ctx.fillText(`Tan slope: ${slope.toFixed(2)}`, 10, 120);
                ctx.fillText('Q1', 3 / 4 * canvas.width, 1 / 4 * canvas.height)
                ctx.fillText('Q2', 1 / 4 * canvas.width, 1 / 4 * canvas.height)
                ctx.fillText('Q3', 1 / 4 * canvas.width, 3 / 4 * canvas.height)
                ctx.fillText('Q4', 3 / 4 * canvas.width, 3 / 4 * canvas.height)

                ctx.restore();
                window.requestAnimationFrame(render);
            }

            window.requestAnimationFrame(render);
        }
    </script>
    <body style="margin: 0; overflow: hidden;">
        <canvas id="canvas"></canvas>
    </body>
</html>